# Guide complet : Installation et configuration d’Ansible sur RHEL9

## 1. Préparation des machines virtuelles

- **3 VMs RHEL9**
    - 2 Go RAM, 20 Go disque, 1 CPU
    - Hostnames :
        - `server.example.com` (contrôle Ansible)
        - `node1.example.com` (nœud géré 1)
        - `node2.example.com` (nœud géré 2)

### a. Activer le compte Red Hat
```bash
sudo subscription-manager register
sudo subscription-manager attach --auto-attach
```

### b. Changer le hostname
Exemple sur server :
```bash
sudo hostnamectl set-hostname server.example.com
sudo reboot
```
À répéter sur chaque VM avec le hostname correspondant.

### c. Modifier `/etc/hosts`
Sur chaque machine, ajoutez :
```
192.168.***.*** server.example.com
192.168.***.*** node1.example.com
192.168.***.*** node2.example.com
```

### d. Vérifier la résolution DNS
Depuis `server` :
```bash
ping -c 2 node1.example.com
ping -c 2 node2.example.com
```

## 2. Création de l’utilisateur ansible

Sur chaque machine :
```bash
sudo useradd ansible
echo "ansible:ansible" | sudo chpasswd
echo "ansible ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/ansible
sudo chmod 440 /etc/sudoers.d/ansible
```

## 3. Configuration SSH sans mot de passe

Sur `server`, en tant qu’utilisateur ansible :
```bash
su - ansible
ssh-keygen -t rsa -b 4096
ssh-copy-id ansible@node1.example.com
ssh-copy-id ansible@node2.example.com
ssh ansible@node1.example.com
ssh ansible@node2.example.com
```

## 4. Installation d’Ansible sur server

```bash
sudo dnf -y install ansible-core
ansible --version
```

## 5. Préparation du projet Ansible

En tant que `ansible` sur `server` :
```bash
mkdir ~/lab1
cd ~/lab1
nano inventory
```
**Contenu du fichier `inventory` :**
```
[dev]
node1.example.com
node2.example.com
```

```bash
nano ansible.cfg
```
**Contenu du fichier `ansible.cfg` :**
```
[defaults]
inventory = ./inventory
remote_user = ansible
host_key_checking = false
ask_pass = false

[privilege_escalation]
become = true
become_method = sudo
become_user = root
```

## 6. Tester la connexion Ansible

Toujours sur `server`, en tant que `ansible` :
```bash
ansible all -m ping
```
**Résultat attendu :**
```
node1.example.com | SUCCESS => { "changed": false, "ping": "pong" }
node2.example.com | SUCCESS => { "changed": false, "ping": "pong" }
```

---
**Instruction supplémentaire :**  
Pour chaque commande, exécutez-la dans le terminal de la machine concernée, en respectant l’ordre des étapes.